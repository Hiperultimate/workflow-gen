generator client {
  provider     = "prisma-client"
  output       = "../generated"
  moduleFormat = "esm"
  runtime      = "bun"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String        @id @default(uuid())
  email     String        @unique
  password  String
  workflows Workflow[]
  apiKeys   Credentials[]
}

model Workflow {
  id          String   @id @default(uuid())

  User        User     @relation(fields: [userId], references: [id])
  userId      String

  title       String
  enabled     Boolean  @default(true)
  nodes       Json
  connections Json

  webhook     Webhook  @relation(fields: [webhookId], references: [id])
  webhookId   String   @unique
}

model Webhook {
  id        String  @id @default(uuid())
  title     String
  method    Methods @default(GET)
  path      String
  header    String
  secret    String?

  workflow  Workflow?
}

model Credentials {
  id       String   @id @default(uuid())
  title    String
  platform Platform
  data     Json

  user     User    @relation(fields: [userId], references: [id])
  userId   String
}

enum Platform {
  Telegram
  Email
}

enum Methods {
  GET
  POST
  PUT
  DELETE
}
